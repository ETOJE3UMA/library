<template>
  <el-aside>
    <el-menu
      :class="{
        'el-menu-side-nav': true,
        collapsed: collapsed,
      }"
      :collapse="collapsed"
      :collapse-transition="false"
      :router="true"
      @select="collapseMenuIfMobile()"
    >
      <el-menu-item
        :class="classFor('/loan')"
        :route="{ path: '/loan' }"
        index="/loan"
        v-if="hasPermissionToLoan"
        @mouseover="mouseOver"
      >
        <svg
          class="bookreturn"
          width="29"
          height="29"
          viewBox="0 0 29 29"
          xmlns="http://www.w3.org/2000/svg"
          fill="#fff"
        >
          <path
            d="M4.30469 13.5938C4.99013 13.5938 5.61052 13.3187 6.06895 12.8771L8.58393 14.1345C8.57132 14.2369 8.55273 14.3376 8.55273 14.4434C8.55273 15.8488 9.69617 16.9922 11.1016 16.9922C12.507 16.9922 13.6504 15.8488 13.6504 14.4434C13.6504 14.0511 13.5539 13.6838 13.3948 13.3515L16.8066 9.93977C17.1389 10.0988 17.5062 10.1953 17.8984 10.1953C19.3038 10.1953 20.4473 9.05188 20.4473 7.64648C20.4473 7.38187 20.3953 7.13163 20.32 6.89157L23.2844 4.66887C23.6888 4.93902 24.1736 5.09766 24.6953 5.09766C26.1007 5.09766 27.2441 3.95422 27.2441 2.54883C27.2441 1.14343 26.1007 0 24.6953 0C23.2899 0 22.1465 1.14343 22.1465 2.54883C22.1465 2.81345 22.1985 3.06368 22.2737 3.30374L19.3094 5.52644C18.9049 5.25629 18.4202 5.09766 17.8984 5.09766C16.493 5.09766 15.3496 6.24109 15.3496 7.64648C15.3496 8.03876 15.4461 8.40604 15.6052 8.73837L12.1934 12.1501C11.8611 11.991 11.4938 11.8945 11.1016 11.8945C10.4161 11.8945 9.79573 12.1695 9.3373 12.6112L6.82232 11.3538C6.83493 11.2514 6.85352 11.1507 6.85352 11.0449C6.85352 9.63953 5.71008 8.49609 4.30469 8.49609C2.89929 8.49609 1.75586 9.63953 1.75586 11.0449C1.75586 12.4503 2.89929 13.5938 4.30469 13.5938Z"
          />
          <path
            d="M28.1504 27.3008H27.2441V9.3457C27.2441 8.87621 26.864 8.49609 26.3945 8.49609H22.9961C22.5266 8.49609 22.1465 8.87621 22.1465 9.3457V27.3008H20.4473V14.4434C20.4473 13.9739 20.0672 13.5938 19.5977 13.5938H16.1992C15.7297 13.5938 15.3496 13.9739 15.3496 14.4434V27.3008H13.6504V21.2402C13.6504 20.7707 13.2703 20.3906 12.8008 20.3906H9.40234C8.93285 20.3906 8.55273 20.7707 8.55273 21.2402V27.3008H6.85352V17.8418C6.85352 17.3723 6.4734 16.9922 6.00391 16.9922H2.60547C2.13597 16.9922 1.75586 17.3723 1.75586 17.8418V27.3008H0.849609C0.380112 27.3008 0 27.6809 0 28.1504C0 28.6199 0.380112 29 0.849609 29H28.1504C28.6199 29 29 28.6199 29 28.1504C29 27.6809 28.6199 27.3008 28.1504 27.3008Z"
          />
        </svg>
        <span class="title" slot="title" v-show="active">
          <app-i18n code="entities.loan.menu"></app-i18n>
        </span>
      </el-menu-item>

      <el-menu-item
        class="book"
        :class="classFor('/book')"
        :route="{ path: '/book' }"
        index="/book"
        v-if="hasPermissionToBook"
      >
        <svg
          class="book"
          width="29"
          height="29"
          viewBox="0 0 29 29"
          xmlns="http://www.w3.org/2000/svg"
          fill="#fff"
        >
          <g clip-path="url(#clip0)">
            <path
              d="M10.0186 12.4446V23.1161C10.0186 23.5906 9.71943 24.0127 9.27283 24.169C8.64089 24.3912 7.87832 24.5084 7.06662 24.5084C4.73202 24.5084 2.221 23.5504 2.221 21.447V7.79215C2.16853 6.85429 2.49566 5.1974 4.06658 4.30085C4.79566 3.8844 8.62414 1.42251 10.5468 0.17873C10.8895 -0.0434532 11.3272 -0.0590842 11.6867 0.135187C12.0462 0.331691 12.2695 0.707952 12.2695 1.11659V2.73328C12.2695 3.34959 11.7693 3.84979 11.153 3.84979C10.6729 3.84979 10.2632 3.54721 10.1057 3.12071C8.36846 4.23721 5.80944 5.87624 5.17415 6.2391C4.6025 6.56623 4.47857 7.16691 4.45401 7.49293C4.45401 7.85914 4.53328 8.1472 4.67619 8.30463C5.07255 8.73671 6.39337 8.46764 7.83477 7.60235C9.21923 6.77167 16.0478 2.22528 16.1159 2.1795C16.4609 1.95062 16.9008 1.9294 17.2614 2.12479C17.6254 2.31906 17.852 2.69756 17.852 3.10955V3.23683C17.852 3.60974 17.6656 3.95809 17.3563 4.16576C17.3563 4.16576 12.6156 7.32992 12.1958 7.599C10.5892 8.63288 10.0186 9.90122 10.0186 12.4446ZM26.784 7.05638V21.5508C26.784 21.9338 26.5864 22.291 26.2615 22.4954C26.2615 22.4954 19.7523 27.5509 18.4315 28.3536C17.737 28.7768 16.8528 29.0001 15.8758 29.0001C13.5546 29.0001 11.153 27.744 11.153 25.6439V12.1164V11.7892C11.153 11.7848 11.1564 11.7803 11.1564 11.7747C11.1787 10.9574 11.3696 9.79069 12.8892 8.66972C13.8002 7.99759 19.2264 4.2975 19.4564 4.14119C19.7992 3.90896 20.2425 3.8844 20.6064 4.07644C20.9726 4.26959 21.2015 4.6492 21.2015 5.06342V6.68012C21.2015 7.29642 20.7024 7.79662 20.085 7.79662C19.6239 7.79662 19.2276 7.51749 19.0578 7.11778C17.3261 8.30239 14.7839 10.0475 14.2145 10.4662C13.4954 10.9976 13.3994 11.3482 13.3871 11.7982C13.3894 12.132 13.4798 12.3866 13.6629 12.554C14.2323 13.0754 15.7653 12.8566 17.277 11.95C18.3958 11.2779 23.2168 7.55545 24.9786 6.17769C25.3169 5.91643 25.7725 5.86842 26.1566 6.05488C26.5406 6.24133 26.784 6.62876 26.784 7.05638ZM24.551 12.0315L18.9685 16.3624V18.5954L24.551 14.2645V12.0315Z"
            />
          </g>
          <defs>
            <clipPath id="clip0">
              <rect width="29" height="29" />
            </clipPath>
          </defs>
        </svg>
        <span class="title" slot="title">
          <app-i18n code="entities.book.menu"></app-i18n>
        </span>
      </el-menu-item>

      <el-menu-item
        :class="classFor('/iam')"
        :route="{ path: '/iam' }"
        index="/iam"
        v-if="hasPermissionToIam"
      >
        <svg
          class="iam"
          width="30"
          height="30"
          viewBox="0 0 30 30"
          xmlns="http://www.w3.org/2000/svg"
          fill="#fff"
        >
          <g clip-path="url(#clip0)">
            <path
              d="M17.9924 6.68633C19.3333 7.52705 20.2736 8.94972 20.4448 10.6011C20.9916 10.8566 21.5985 11.0036 22.242 11.0036C24.5912 11.0036 26.4952 9.09956 26.4952 6.75075C26.4952 4.40158 24.5912 2.49756 22.242 2.49756C19.9153 2.49828 18.0279 4.36828 17.9924 6.68633ZM15.2061 15.3947C17.5552 15.3947 19.4593 13.4903 19.4593 11.1415C19.4593 8.79265 17.5549 6.88864 15.2061 6.88864C12.8573 6.88864 10.9522 8.79302 10.9522 11.1418C10.9522 13.4906 12.8573 15.3947 15.2061 15.3947ZM17.0102 15.6845H13.4012C10.3984 15.6845 7.95553 18.1278 7.95553 21.1306V25.5441L7.96675 25.6132L8.27076 25.7084C11.1364 26.6038 13.626 26.9024 15.6751 26.9024C19.6775 26.9024 21.9974 25.7613 22.1403 25.6885L22.4244 25.5448H22.4548V21.1306C22.4559 18.1278 20.013 15.6845 17.0102 15.6845ZM24.0469 11.2938H20.4657C20.427 12.7266 19.8154 14.0169 18.848 14.9448C21.5171 15.7385 23.47 18.2136 23.47 21.1371V22.4972C27.0059 22.3676 29.0434 21.3655 29.1777 21.2982L29.4618 21.1541H29.4922V16.7392C29.4922 13.7367 27.0493 11.2938 24.0469 11.2938ZM7.74309 11.0043C8.57513 11.0043 9.34926 10.7615 10.005 10.3478C10.2135 8.98809 10.9424 7.79993 11.9836 6.99069C11.988 6.91107 11.9956 6.83218 11.9956 6.75183C11.9956 4.40266 10.0912 2.49864 7.74309 2.49864C5.39356 2.49864 3.4899 4.40266 3.4899 6.75183C3.4899 9.09992 5.39356 11.0043 7.74309 11.0043ZM11.5627 14.9448C10.6 14.0216 9.99057 12.7382 9.94605 11.3141C9.81323 11.3043 9.68185 11.2938 9.5465 11.2938H5.93788C2.93509 11.2938 0.492188 13.7367 0.492188 16.7392V21.1534L0.503407 21.2214L0.807413 21.3173C3.10628 22.035 5.15796 22.3658 6.94001 22.47V21.1371C6.94073 18.2136 8.89289 15.7392 11.5627 14.9448Z"
            />
          </g>
          <defs>
            <clipPath id="clip0">
              <rect
                width="29"
                height="29"
                transform="translate(0.492188 0.200195)"
              />
            </clipPath>
          </defs>
        </svg>
        <span class="title" slot="title">
          <app-i18n code="iam.menu"></app-i18n>
        </span>
      </el-menu-item>

      <el-menu-item
        :class="classFor('/settings')"
        :route="{ path: '/settings' }"
        index="/settings"
        v-if="hasPermissionToSettings"
      >
        <svg
          class="settings"
          width="30"
          height="30"
          viewBox="0 0 30 30"
          xmlns="http://www.w3.org/2000/svg"
          fill="#fff"
        >
          <path
            d="M30.0658 17.878L27.2617 15.7937C27.3486 15.0662 27.3486 14.3317 27.2617 13.6042L30.0684 11.5186C30.5944 11.116 30.7349 10.4099 30.4002 9.85233L27.4828 5.05891C27.1468 4.49783 26.4312 4.2528 25.796 4.48135L22.491 5.74528C21.8699 5.31696 21.2046 4.94976 20.5054 4.64934L19.9982 1.31192C19.9067 0.671203 19.3284 0.194971 18.6482 0.200239H12.8009C12.1263 0.196387 11.5527 0.667295 11.4585 1.30223L10.9501 4.64928C10.253 4.95259 9.58877 5.32008 8.96705 5.74647L5.65306 4.4801C5.02443 4.24453 4.30946 4.48661 3.97893 5.04679L1.05905 9.8487C0.715294 10.4072 0.856811 11.121 1.39082 11.5223L4.19499 13.6066C4.10722 14.3341 4.10722 15.0687 4.19499 15.7961L1.38826 17.8805C0.861399 18.2826 0.720181 18.989 1.05523 19.5468L3.97131 24.3414C4.3069 24.9029 5.02294 25.1481 5.65813 24.919L8.96318 23.6551C9.58478 24.0836 10.2505 24.4512 10.95 24.7523L11.4585 28.0872C11.548 28.7263 12.1227 29.2027 12.8008 29.2001H18.6482C19.324 29.2053 19.8995 28.7342 19.9943 28.0981L20.5028 24.7511C21.1998 24.4477 21.8639 24.0802 22.4858 23.6539L25.8035 24.9214C26.4322 25.1564 27.1468 24.9145 27.4777 24.3548L30.4064 19.5335C30.7343 18.9768 30.5902 18.2763 30.0658 17.878ZM15.7245 20.7418C12.2143 20.7418 9.36866 18.0369 9.36866 14.7001C9.36866 11.3634 12.2142 8.65846 15.7245 8.65846C19.2348 8.65846 22.0804 11.3634 22.0804 14.7001C22.0761 18.0352 19.233 20.7378 15.7245 20.7418Z"
          />
        </svg>
        <span class="title" slot="title">
          <app-i18n code="settings.menu"></app-i18n>
        </span>
      </el-menu-item>
    </el-menu>
  </el-aside>
</template>

<script>
import { mapGetters, mapActions } from 'vuex';
import { SettingsPermissions } from '@/modules/settings/settings-permissions';
import { AuditLogPermissions } from '@/modules/audit-log/audit-log-permissions';
import { IamPermissions } from '@/modules/iam/iam-permissions';
import { LoanPermissions } from '@/modules/loan/loan-permissions';
import { BookPermissions } from '@/modules/book/book-permissions';

export default {
  name: 'app-menu',
  data() {
    return {
      active: false,
    };
  },

  computed: {
    ...mapGetters({
      collapsed: 'layout/menuCollapsed',
      isMobile: 'layout/isMobile',
      currentUser: 'auth/currentUser',
    }),

    hasPermissionToSettings() {
      return new SettingsPermissions(this.currentUser).edit;
    },

    hasPermissionToAuditLog() {
      return new AuditLogPermissions(this.currentUser).read;
    },

    hasPermissionToIam() {
      return new IamPermissions(this.currentUser).read;
    },

    hasPermissionToLoan() {
      return new LoanPermissions(this.currentUser).read;
    },
    hasPermissionToBook() {
      return new BookPermissions(this.currentUser).read;
    },

    asideWidth() {
      if (!this.collapsed) {
        return '200px';
      }

      return '0px';
    },
  },

  methods: {
    ...mapActions({
      collapseMenu: 'layout/collapseMenu',
    }),

    collapseMenuIfMobile() {
      if (this.isMobile) {
        this.collapseMenu();
      }
    },

    classFor(path, exact = false) {
      if (exact) {
        return {
          active: this.$route.path === path,
        };
      }

      return {
        active: this.$route.path.startsWith(path),
      };
    },

    mouseOver: function () {
      this.active = !this.active;
    },
  },
};
</script>

<style scoped>
.el-menu.collapsed span {
  visibility: hidden;
}
</style>
